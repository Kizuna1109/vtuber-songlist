<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTuber é»æ­Œæ­Œå–® - æ­Œæ›²åˆ—è¡¨</title>
    <style>
        /* åŸºç¤æ¨£å¼ï¼šæ·±è‰²ä¸»é¡Œï¼Œç¬¦åˆå¤šæ•¸ VTuber ä»‹é¢ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e; /* æ·±è—ç´«èƒŒæ™¯ */
            color: #e4e6eb; /* æ·ºç°æ–‡å­— */
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: auto;
            background-color: #2c2c4a; /* ç¨å¾®äº®ä¸€é»çš„ä¸»é«”èƒŒæ™¯ */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        h1 {
            color: #00bcd4; /* é†’ç›®è—è‰²æ¨™é¡Œ */
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #00bcd4;
            padding-bottom: 10px;
        }

        /* æœå°‹æ¡†æ¨£å¼ */
        #searchBar {
            width: 100%;
            padding: 12px 20px;
            margin-bottom: 20px;
            border: 2px solid #5d5d81;
            border-radius: 8px;
            background-color: #1a1a2e;
            color: #e4e6eb;
            font-size: 16px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒå¢åŠ ç¸½å¯¬åº¦ */
        }
        
        #searchBar::placeholder {
            color: #a0a0c0;
        }

        /* è¡¨æ ¼æ¨£å¼ */
        .song-table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            color: #e4e6eb;
        }

        th {
            background-color: #5d5d81; /* è¡¨é ­èƒŒæ™¯ */
            color: white;
            padding: 12px 15px;
            text-align: left;
            cursor: pointer; /* é»æ“Šæ’åº */
            user-select: none;
            position: sticky;
            top: 0;
        }

        th:hover {
            background-color: #7b7b9d;
        }

        td {
            padding: 10px 15px;
            border-bottom: 1px solid #4a4a75;
        }

        tr:nth-child(even) {
            background-color: #38385e; /* æ–‘é¦¬ç´‹ */
        }

        tr:hover {
            background-color: #4a4a75;
        }

        /* å‚™è¨»æ¨£å¼ */
        .notes {
            font-style: italic;
            color: #a0a0c0;
        }
        
        /* è¼‰å…¥/éŒ¯èª¤è¨Šæ¯ */
        #statusMessage {
            text-align: center;
            padding: 20px;
            color: #ffcc00;
        }
        
        /* æ’åºæŒ‡ç¤ºç®­é ­ (å¯é¸) */
        .sort-indicator {
            margin-left: 5px;
            font-size: 0.8em;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¶ æ‚¨çš„ VTuber é»æ­Œæ­Œå–® ğŸ¶</h1>
    <p>ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥è¼¸å…¥æ­Œåã€æ­Œæ‰‹æˆ–èªè¨€ä¾†å³æ™‚ç¯©é¸æ­Œæ›²ï¼</p>
    
    <input type="text" id="searchBar" placeholder="ğŸ” è¼¸å…¥é—œéµå­—æœå°‹...">
    
    <div class="song-table-container">
        <table>
            <thead>
                <tr>
                    <th data-col="songName">æ­Œæ›²åç¨± <span class="sort-indicator"></span></th>
                    <th data-col="artist">æ­Œæ‰‹/åŸå”± <span class="sort-indicator"></span></th>
                    <th data-col="language">èªè¨€ <span class="sort-indicator"></span></th>
                    <th data-col="notes">å‚™è¨» <span class="sort-indicator"></span></th>
                </tr>
            </thead>
            <tbody id="songTableBody">
                <tr><td colspan="4" id="statusMessage">æ­£åœ¨è¼‰å…¥æ­Œå–®è³‡æ–™...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
// ===============================================================
// ** æ ¸å¿ƒè¨­å®šï¼šè«‹å°‡ä¸‹æ–¹çš„é€£çµæ›¿æ›æˆæ‚¨ Google Sheets ç™¼å¸ƒçš„ CSV é€£çµ **
// æ­¥é©Ÿï¼šGoogle Sheets -> æª”æ¡ˆ -> åˆ†äº« -> ç™¼å¸ƒåˆ°ç¶²è·¯ -> é€£çµ -> é¸æ“‡ã€Œé€—è™Ÿåˆ†éš”å€¼ (.csv)ã€
// ===============================================================
const SHEET_URL = https://docs.google.com/spreadsheets/d/e/2PACX-1vTdrMc1Yj5dp1ic_J7xBZxh9ypKhkO450u4973XnAlZ-JMvvDz2gKH4SQCrStQUOQbnB_s87fBUAU5T/pub?output=csv
// ===============================================================
// è«‹ç¢ºä¿æ‚¨çš„ Google Sheets æ¬„ä½åç¨± (ç¬¬ä¸€åˆ—) æ˜¯ä»¥ä¸‹è‹±æ–‡å­—æ¯ï¼š
const COLUMN_MAPPING = ['songName', 'artist', 'language', 'notes'];
// ===============================================================

let songData = [];
let sortColumn = 'songName';
let sortDirection = 1; // 1 = å‡åº (A-Z, 0-9), -1 = é™åº (Z-A, 9-0)

/**
 * å¾ URL è¼‰å…¥ CSV è³‡æ–™ä¸¦è§£æ
 */
async function loadSongList() {
    const statusElement = document.getElementById('statusMessage');
    statusElement.textContent = 'æ­£åœ¨è¼‰å…¥æ­Œå–®è³‡æ–™...';
    
    try {
        const response = await fetch(SHEET_URL);
        if (!response.ok) throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹ç¢¼: ${response.status}`);
        
        const csvText = await response.text();
        songData = parseCSV(csvText);
        
        if (songData.length > 0) {
            statusElement.remove(); // è¼‰å…¥æˆåŠŸï¼Œç§»é™¤ç‹€æ…‹è¨Šæ¯
            renderTable(songData);
        } else {
            statusElement.textContent = 'æ­Œå–®ç‚ºç©ºæˆ–è§£æå¤±æ•—ã€‚è«‹æª¢æŸ¥æ‚¨çš„ Google Sheets é€£çµå’Œå…§å®¹ã€‚';
        }
        
    } catch (error) {
        console.error('ç„¡æ³•è¼‰å…¥æˆ–è§£ææ­Œå–®:', error);
        statusElement.textContent = `è¼‰å…¥å¤±æ•—: ${error.message}ã€‚è«‹ç¢ºèªé€£çµæ˜¯å¦æ­£ç¢ºä¸”å·²å…¬é–‹ç™¼å¸ƒã€‚`;
    }
}

/**
 * ç°¡æ˜“ CSV è§£æå™¨
 * @param {string} csvText - ä¾†è‡ª Google Sheets çš„ CSV æ–‡æœ¬
 * @returns {Array<Object>} æ­Œæ›²ç‰©ä»¶é™£åˆ—
 */
function parseCSV(csvText) {
    const lines = csvText.split('\n').filter(line => line.trim() !== '');
    if (lines.length < 1) return [];

    // ç”±æ–¼ Google Sheets ç™¼å¸ƒçš„ CSV å¯èƒ½æœƒæœ‰éš±è—çš„æ¨™é¡Œè¡Œæˆ–ç·¨ç¢¼å•é¡Œï¼Œ
    // æˆ‘å€‘ç›´æ¥ä½¿ç”¨é è¨­çš„ COLUMN_MAPPING æ¨™é¡Œï¼Œä¸¦å¾ç¬¬äºŒè¡Œé–‹å§‹è®€å–æ•¸æ“šã€‚
    
    const data = [];
    // å¾ç¬¬ä¸€è¡Œ (index 0) é–‹å§‹è®€å–æ•¸æ“šè¡Œ
    for (let i = 0; i < lines.length; i++) {
        // ä½¿ç”¨ä¸€å€‹ç°¡å–®çš„åˆ†å‰²é‚è¼¯ (å¯èƒ½æœƒå°åŒ…å«é€—è™Ÿçš„å…§å®¹å¤±æ•ˆï¼Œä½†å°æ–¼æ¨™æº–æ­Œå–®è¶³å¤ )
        const values = lines[i].split(',').map(v => v.trim().replace(/^"|"$/g, ''));

        if (values.length !== COLUMN_MAPPING.length) {
             // æ¬„ä½æ•¸é‡ä¸å°ï¼Œç•¥éæ­¤è¡Œ
             continue;
        }

        const song = {};
        COLUMN_MAPPING.forEach((key, index) => {
            song[key] = values[index];
        });
        
        // ç‚ºäº†é¿å…è®€å–åˆ° CSV çš„åŸå§‹æ¨™é¡Œè¡Œ (æœ‰æ™‚æœƒè¢«è¦–ç‚ºæ•¸æ“š)ï¼Œå¯ä»¥åŠ å…¥ä¸€å€‹ç°¡å–®æª¢æŸ¥
        // å‡è¨­æ­Œåä¸€å®šä¸æœƒæ˜¯ 'songName' é€™å€‹å­—ä¸²ï¼Œå¯ä»¥ç•¥éç¬¬ä¸€è¡Œã€‚
        if (i === 0 && song.songName.toLowerCase() === 'songname') {
            continue; // è·³éæ¨™é¡Œè¡Œ
        }
        
        data.push(song);
    }
    return data;
}


/**
 * æ¸²æŸ“æˆ–æ›´æ–°è¡¨æ ¼å…§å®¹
 * @param {Array<Object>} songs - è¦é¡¯ç¤ºçš„æ­Œæ›²é™£åˆ—
 */
function renderTable(songs) {
    const tableBody = document.getElementById('songTableBody');
    tableBody.innerHTML = '';
    
    if (songs.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4" class="notes">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ­Œæ›²ã€‚</td></tr>';
        return;
    }

    // æ‡‰ç”¨æ’åº
    songs.sort((a, b) => {
        const valA = String(a[sortColumn]).toLowerCase();
        const valB = String(b[sortColumn]).toLowerCase();
        
        if (valA < valB) return -1 * sortDirection;
        if (valA > valB) return 1 * sortDirection;
        return 0;
    });

    // ç¹ªè£½è¡¨æ ¼è¡Œ
    songs.forEach(song => {
        const row = tableBody.insertRow();
        
        // æ ¹æ“š COLUMN_MAPPING å‹•æ…‹ç”Ÿæˆå„²å­˜æ ¼
        COLUMN_MAPPING.forEach(key => {
            const cell = row.insertCell();
            cell.textContent = song[key];
            if (key === 'notes') {
                cell.classList.add('notes');
            }
        });
    });
    
    updateSortIndicators();
}

/**
 * è™•ç†å³æ™‚æœå°‹/ç¯©é¸
 */
function handleSearch() {
    const query = document.getElementById('searchBar').value.toLowerCase();
    
    const filteredSongs = songData.filter(song => {
        // æœå°‹æ‰€æœ‰å¯è¦‹çš„æ¬„ä½
        return COLUMN_MAPPING.some(key => 
            String(song[key]).toLowerCase().includes(query)
        );
    });
    
    renderTable(filteredSongs);
}

/**
 * è™•ç†é»æ“Šè¡¨é ­é€²è¡Œæ’åº
 */
function handleSort(event) {
    const clickedColumn = event.currentTarget.getAttribute('data-col');
    
    if (clickedColumn === sortColumn) {
        // å¦‚æœé»æ“Šçš„æ˜¯åŒä¸€æ¬„ï¼Œåˆ‡æ›æ’åºæ–¹å‘
        sortDirection *= -1;
    } else {
        // å¦‚æœé»æ“Šçš„æ˜¯ä¸åŒæ¬„ï¼Œåˆ‡æ›åˆ°è©²æ¬„ä¸¦é è¨­ç‚ºå‡åº
        sortColumn = clickedColumn;
        sortDirection = 1; 
    }
    
    // é‡æ–°æ¸²æŸ“ï¼ŒrenderTable æœƒä½¿ç”¨æœ€æ–°çš„ sortColumn å’Œ sortDirection
    renderTable(songData.filter(song => {
        const query = document.getElementById('searchBar').value.toLowerCase();
        return COLUMN_MAPPING.some(key => String(song[key]).toLowerCase().includes(query));
    }));
}

/**
 * æ›´æ–°è¡¨é ­çš„æ’åºæŒ‡ç¤ºç®­é ­
 */
function updateSortIndicators() {
    document.querySelectorAll('th').forEach(th => {
        const indicator = th.querySelector('.sort-indicator');
        indicator.textContent = ''; // æ¸…é™¤æ‰€æœ‰æŒ‡ç¤º

        if (th.getAttribute('data-col') === sortColumn) {
            // è¨­ç½®ç•¶å‰æ’åºæ¬„ä½çš„æŒ‡ç¤º
            indicator.textContent = sortDirection === 1 ? 'â–²' : 'â–¼';
        }
    });
}

// ===============================================================
// ç¶²é è¼‰å…¥å¾Œï¼ŒåŸ·è¡Œåˆå§‹åŒ–
// ===============================================================
document.addEventListener('DOMContentLoaded', () => {
    // ç¶å®šæœå°‹äº‹ä»¶
    document.getElementById('searchBar').addEventListener('keyup', handleSearch);
    
    // ç¶å®šæ’åºäº‹ä»¶
    document.querySelectorAll('th[data-col]').forEach(header => {
        header.addEventListener('click', handleSort);
    });
    
    // è¼‰å…¥è³‡æ–™
    loadSongList();
});

</script>

</body>
</html>